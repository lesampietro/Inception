# Inception - Developer Documentation

This documentation provides technical details for developers looking to set up, build, and maintain the Inception infrastructure.

## 1. Environment Setup

### Prerequisites
Before starting, ensure your host machine (Linux VM) has the following installed:
- **Docker** Engine
- **Docker Compose**
- **Make** (build essential)
- **Git**

### Configuration Files
The project relies on environment variables to configure services dynamically. 

1.  **Create the `.env` file**:
    Navigate to `srcs/` and ensure a `.env` file exists. It should contain variables for domain names, database credentials, and paths. 
    
    *Example structure:*
    ```dotenv
    DOMAIN_NAME=lsampiet.42.fr
    MYSQL_DATABASE=wordpress
    MYSQL_USER=user
    MYSQL_PASSWORD=userpass
    MYSQL_ROOT_PASSWORD=rootpass
    WP_ADMIN_USER=admin
    WP_ADMIN_PASSWORD=adminpass
    ```

2.  **Host Configuration**:
    Map the domain name to localhost in your `/etc/hosts` file:
    ```bash
    echo "127.0.0.1 lsampiet.42.fr" >> /etc/hosts
    ```

### Secrets Management
This project uses Docker Secrets for sensitive data. 
- Secrets are typically generated or read from local files (e.g., `secrets/db_password.txt`) referenced in `docker-compose.yml`.
- Ensure the `secrets/` folder (if used in your specific configuration) exists or is generated by the makefile before build.

## 2. Build and Launch

The project is automated using a `Makefile` located at the root.

*   **Build & Start (Default):**
    Builds images ensuring secrets/volumes exist, then starts the cluster in detached mode.
    ```bash
    make
    ```

*   **Rebuild specific container:**
    If you modify a Dockerfile (e.g., specific PHP extensions), you must force a rebuild:
    ```bash
    docker-compose -f srcs/docker-compose.yml build --no-cache <service_name>
    ```

## 3. Container & Volume Management

Use these commands to manage the lifecycle of the infrastructure during development.

| Command | Description |
| :--- | :--- |
| `make up` | Start existing containers without rebuilding. |
| `make down` | Stop containers and remove external networks. |
| `make prune` | Remove cached information from unused containers, networks, and images (dangling) to free space. |
| `make clean` | Stop execution and remove containers/networks. |
| `docker logs -f <container>` | Follow the logs of a specific service (nginx, mariadb, wordpress) for debugging. |
| `docker exec -it <container> bash` | Open a shell inside a running container to inspect files or run commands manually. |

## 4. Data Storage & Persistence

Data persistence is handled via **Docker Volumes** mapped to specific directories on the host machine.

### Storage Locations
According to the project subject requirements, data is stored in the user's home directory:

*   **WordPress Files:** stored in `/home/$USER/data/wordpress`
*   **Database Files:** stored in `/home/$USER/data/mariadb`

### How Persistence Works
- **Docker Compose** defines named volumes (e.g., `wp_data`, `db_data`).
- These volumes use the `driver_opts` feature (or direct bind mounts depending on implementation) to map the internal container paths (`/var/www/html`, `/var/lib/mysql`) to the physical paths on the host listed above.
- **Result:** Even if containers are destroyed (`make down`), the data remains in `/home/$USER/data`. To completely wipe data, you must manually delete these folders or use `make fclean`.